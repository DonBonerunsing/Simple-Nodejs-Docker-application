pipeline {
    agent any
    stages {
      stage('Checkout') {
        steps {
            git branch: 'main', url: 'https://github.com/ooghenekaro/Simple-Nodejs-Docker-application.git'  
        }
      }
      stage("Docker Build") {
            steps {
                 sh " docker build -t registry.digitalocean.com/ayoregistry/test-image:latest ."
            }
        }
      stage("Docker Login") {
                     steps {
                   //sh "docker login registry.digitalocean.com"
                    //sh ""
                     sh "doctl auth init --context default -t 'karo-do-token'"
                    sh "doctl registry login"    
                 }
      }  
      stage("Docker Push") {
            steps {
                sh "docker push registry.digitalocean.com/ayoregistry/test-image:latest"
              //sh "KUBECONFIG=/var/jenkins_home/.kube/config.yaml kubectl set image deployment/deployment-name container-name=registry.digitalocean.com/supportgenie/react-apps-portal:$buildId --record"
            }
        }
    }
}
